#!/bin/bash

chemin=$PWD
. ~/.mvc
action=$1

complement_ou_nom=$2
nom_composant=$3

if  test $action = "cree"
then
    if [ -f .racine ]
        then
            if [ $complement_ou_nom != "all" ] &&[ $complement_ou_nom != "modele" ] && [ $complement_ou_nom != "vue" ] && [ $complement_ou_nom != "action" ] && [ $complement_ou_nom != "controleur" ]
                then
                    echo 'erreur de commande'
                else
                  if [ $2 = "all" ]
                  then
                    creations="vue controleur modele"
                  else
                    creations=$2
                  fi

                  for element in $creations
                  do
                    echo "création d'un fichier $element: $chemin/app/$element/$element.$nom_composant.rb"
                    sed s/"<nom-$element>"/"$element_$nom_composant"/g $installation/modeles/$element.rb >> $chemin/app/$element/$nom_composant.$element.rb
                    echo "création d'un test pour $creations: $chemin/test/$creations/$nom_composant.$creations.test.rb"
                    sed s/"<nom-$element>"/"$element_$nom_composant"/g $installation/modeles/test/test_$element.rb >> $chemin/test/$element/$nom_composant.$element.test.rb
                    chmod +x $chemin/test/$element/$nom_composant.$element.test.rb
                  done
               fi
        else
            echo 'vous devez être a la racine de votre projet pour executer cette commande'
        fi

else

    if [ $action = "init" ]
    then
        echo "création de l'arborescence"
        liste="$complement_ou_nom $complement_ou_nom/lib $complement_ou_nom/test $complement_ou_nom/scripts $complement_ou_nom/app"
        liste="$liste $complement_ou_nom/app/vue $complement_ou_nom/app/vue/java $complement_ou_nom/app/vue/jar $complement_ou_nom/app/controleur $complement_ou_nom/app/modele"
        liste="$liste $complement_ou_nom/app/action $complement_ou_nom/test/vue $complement_ou_nom/test/controleur $complement_ou_nom/test/modele $complement_ou_nom/test/action"
        for doss in $liste
        do
            (mkdir $doss && echo Création de $doss) || echo Erreur lors de la création de $doss
        done
        touch $complement_ou_nom/.racine
        cp $installation/modeles/lib/* $chemin/$complement_ou_nom/lib/
        

    elif [ $action = "copie" ] && ( [ $complement_ou_nom = "jar" ] || [ $complement_ou_nom = "java" ] )
    then cp $nom_composant $chemin/app/vue/$complement_ou_nom/
    elif [ $action = "jar" ]
    then
      rm -r monbuild
      mkdir monbuild
      mkdir monbuild/lib
      cp $installation/lib/jruby-complete.jar monbuild/lib/
      cp $installation/lib/MANIFEST.MF monbuild/
      cp *.rb monbuild
      cp -R app monbuild/
      cp lib/* monbuild/
      #cp -R app/vue/jar monbuild/lib
      cp -R modules monbuild/lib
      cd monbuild
      javac -cp ./lib/jruby-complete.jar Main.java
      rm Main.java
      rm app/vue/*~
      rm app/controleur/*~
      rm app/modele/*~
      jar cvfm coucou.jar MANIFEST.MF *.rb *.class app/
    else
        echo 'aide de commande'
    fi
fi

